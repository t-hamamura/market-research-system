# AI Market Research System

[![AI Powered](https://img.shields.io/badge/AI-Gemini%20Powered-4A90C2?style=for-the-badge)]()
[![Database](https://img.shields.io/badge/Database-Notion%20API-000000?style=for-the-badge&logo=notion)]()
[![Framework](https://img.shields.io/badge/Framework-Node.js-339933?style=for-the-badge&logo=node.js)]()

**＼ 事業の可能性を、データで見極める ／**

最先端のAI市場調査自動化システム。わずか数分で、16種類の本格的な市場調査が完了。

Gemini AIとNotion APIを活用して、専門的な市場調査を並列実行し、構造化されたビジネス分析レポートをNotion上に自動生成する高度なソリューションです。

---

## 🎯 システム概要

### 🚀 最新の改善機能（v1.4.0）
- **🎨 Notion装飾色制限対応**: テキスト色（通常・赤色）、背景色（黄色）のみ使用で統一感向上
- **📊 「調査レポート」タイトル対応**: Notionデータベースの「調査レポート」プロパティを自動認識
- **🔧 動的プロパティ検索**: 多様なタイトルフィールド名に対応（Report Title、report_titleなど）
- **✨ 装飾制限付きリッチテキスト**: 制限された色パレット内での最適な視覚化
- **📝 TalkLabel対応入力フォーム**: LINE特化MA事業の詳細な事例をプレースホルダーに採用
- **🎨 洗練されたUI**: モダンで直感的なユーザーインターフェース、グラデーション効果とスムーズアニメーション
- **📋 一括入力機能**: テンプレートを使用したワンクリック情報入力、22種類の表記バリエーションに対応
- **📊 リアルタイム進行状況**: 各調査項目の詳細な進行状況表示（未着手・実行中・完了・失敗）
- **⏰ 高精度時間予測**: 複数の予測手法を組み合わせたスマートな完了時間計算
- **🔄 事前作成→ステータス更新方式**: 16種類の調査項目を事前作成し、実行時にステータス更新
- **⚡ Deep Research機能**: タイムアウト対応の高度な市場調査エンジン
- **🛡️ 重複防止システム**: 既存ページ検索による調査項目重複作成の完全防止
- **🔧 JSON→Notion自動変換**: AIが生成するJSON形式を自動でNotionブロックに変換（色制限対応）
- **📈 ステータス管理強化**: Notionプロパティとの連携によるリアルタイムステータス更新

### 核心機能
- **🤖 AI駆動型分析**: Gemini AIが、指定されたサービス仮説に基づき16種類の市場調査を自動実行。
- **⚡ 高速な並列処理**: 複数の調査をバッチで並列実行し、調査時間を大幅に短縮（従来比3倍以上）。
- **📊 構造化レポート**: AIの応答を単なるマークダウンではなく、Notionに最適化された**構造化レポート**として生成。色制限内での最適な装飾で、視覚的で分かりやすいレポートを作成します。
- **📋 リアルタイム保存**: 各調査の完了ごとに、結果を個別のNotionページとして即座に保存。
- **🛡️ 高度なエラー耐性**: APIのレート制限やネットワークエラーに対応する自動リトライ機能、途中から調査を再開できるチェックポイント機能などを搭載。
- **🎨 直感的なUI**: 美しく使いやすいユーザーインターフェース、リアルタイムフィードバック付き。

### 対象ユーザー
- **事業企画・開発者**: 新規事業のアイデア検証や市場参入戦略の策定に。
- **経営層・マネージャー**: データに基づいた迅速な意思決定のための情報収集に。
- **コンサルタント**: クライアント向けの市場分析レポート作成の効率化に。
- **スタートアップ・起業家**: 投資家向け資料作成や、MVP開発前の市場調査に。

---

## ✨ 主要機能

### 🎨 Notion装飾の最適化（v1.4.0新機能）
- **📋 色制限対応**: テキスト色（通常・赤色）、背景色（黄色）のみ使用で視覚的統一感を実現
- **💡 Callout強化**: 黄色背景のCalloutブロックで重要ポイントを効果的に強調
- **⚠️ 警告表示**: 赤色テキストでクリティカルなリスクや注意事項を明確に表示
- **📊 表形式データ**: 制限された色パレット内での最適な表デザイン
- **🔗 見出し階層**: H1-H3の階層構造で情報を論理的に整理

### 🎯 スマートな一括入力
- **TalkLabel事例テンプレート**: LINE特化フルファネルMAの詳細な事業モデルを例として採用
- **インテリジェント解析**: 自由形式のテキストを各フィールドに自動分類（22種類の表記バリエーション対応）
- **トグル式表示**: 必要な時だけ表示される、画面を圧迫しないデザイン
- **リアルタイム検証**: 入力内容の妥当性を即座にチェック

### 📊 詳細な進行状況表示（20ステップ構成）
各調査項目の状態をリアルタイムで視覚化：
- **Phase 1: 事前作成フェーズ（3ステップ）**
  - システム初期化
  - 調査項目事前作成（16項目）
  - 統合レポート事前作成
- **Phase 2: 調査実行フェーズ（16ステップ）**
  - 16種類の専門調査を並列実行
  - Deep Research機能によるタイムアウト対応
- **Phase 3: 統合レポート更新フェーズ（1ステップ）**
  - 全調査結果の統合・分析レポート生成

### ⏰ 高精度時間予測システム
複数の予測アルゴリズムを組み合わせた次世代時間計算：
- **線形予測**: 従来の進行率ベース計算
- **フェーズベース予測**: 各調査フェーズの特性を考慮
- **適応的予測**: 実際の実行時間から学習する自己改善型
- **スマート表示**: 残り10秒以下で「まもなく完了」を正確に表示

### Notionに最適化されたレポート出力（色制限対応）
本システムの最大の特徴は、AIの生成結果をNotionのブロック構造に最適化された**構造化レポート**で出力し、指定された色制限内で美しく表示する点にあります。

- **📄 統合レポートページ**: 全16種類の調査結果を統合し、色制限内での最適な装飾で包括的なレポートを生成。
- **📂 個別調査ページ（トグル形式）**: 統合レポート内では、各調査結果が**トグルリスト**に格納されます。
- **✨ リッチな表現力**: **黄色背景のCallout**、**赤色テキストの警告**、色分けされた**見出し**、**箇条書き**などを活用。
- **📊 表形式データ**: 制限された色パレット内での最適化されたテーブルデザイン。

---

## 🔬 調査機能詳細

### 16種類の専門調査項目
ビジネス分析に必要なフレームワークを網羅した、16の調査項目を自動で実行します。

1.  **市場規模と成長性の調査** - 市場規模・成長予測分析
2.  **PESTEL分析** - 政治・経済・社会・技術・環境・法的要因
3.  **競合製品・戦略分析** - 競合他社の製品特徴・戦略
4.  **競合経営戦略・離脱分析** - 競合戦略変遷・顧客離脱理由
5.  **顧客セグメント・意思決定分析** - ターゲット顧客・購買プロセス
6.  **顧客感情・潜在ニーズ分析** - 顧客インサイト・情報収集行動
7.  **プロダクト市場適合性・価格戦略** - PMF評価・価格設定分析
8.  **マーケティング戦術分析** - 最適チャネル・コンテンツ戦略
9.  **ブランドポジショニング** - ブランド戦略・コミュニケーション
10. **テクノロジー・セキュリティ分析** - 技術動向・リスク対策
11. **パートナーシップ戦略** - 提携先・エコシステム形成
12. **リスク・シナリオ分析** - リスク評価・対応策設計
13. **KPI・測定方法設計** - 成功指標・測定体制構築
14. **法務・コンプライアンス分析** - 法的リスク・規制対応
15. **効果的リサーチ手法提案** - 調査方法論・計画設計
16. **PMF前特化リサーチ設計** - MVP設計・仮説検証手法

---

## 🚀 クイックスタート

### 前提条件
- Node.js (v18以上推奨)
- `npm` or `yarn`
- Gemini API Key
- Notion Integration Token & Database ID

### Notionデータベース設定
システムは以下のプロパティ名に対応しています：
- **タイトルプロパティ**: 「調査レポート」（推奨）、「Report Title」、「事業名」、「Business Name」など
- **ステータスプロパティ**: 「ステータス」、「Status」など
- **その他**: 自動でプロパティを検索・マッピング

### セットアップ手順

1.  **リポジトリのクローン**
    ```bash
    git clone https://github.com/t-hamamura/market-research-system.git
    cd market-research-system
    ```

2.  **依存関係のインストール**
    ```bash
    npm install
    ```

3.  **環境変数の設定**
    `.env.example`をコピーして`.env`ファイルを作成します。
    ```bash
    cp env.example .env
    ```
    `.env`ファイルに必要な情報を入力してください。
    ```env
    # 必須設定
    GEMINI_API_KEY="your_gemini_api_key_here"
    NOTION_TOKEN="your_notion_integration_token"
    NOTION_DATABASE_ID="your_notion_database_id"
    NODE_ENV="production"
    PORT=3000

    # Gemini AI設定（一括管理）
    GEMINI_MODEL="gemini-2.5-flash"
    GEMINI_TEMPERATURE=0.7
    GEMINI_MAX_TOKENS=8192

    # パフォーマンス最適化（任意）
    PARALLEL_BATCH_SIZE=4
    BATCH_INTERVAL=2000
    RESEARCH_INTERVAL=2000
    ```

4.  **ビルド & 起動**
    ```bash
    npm run build
    npm start
    ```

5.  **アクセス**
    ブラウザで `http://localhost:3000` を開きます。

---

## 💡 使用方法

### 基本的な流れ

1. **事業情報の入力**
   - 事業名・サービス名を入力（例：TalkLabel）
   - サービス仮説の必須項目（5項目）を入力
   - 必要に応じて詳細情報（7項目）も入力

2. **一括入力の活用（オプション）**
   - 「一括入力を使用する」ボタンをクリック
   - 「テンプレートをコピー」でTalkLabel事例の雛形を取得
   - 自由形式でテキストを入力し「一括入力を解析」で自動分類

3. **AI市場調査の実行**
   - 「AI市場調査を開始する」ボタンをクリック
   - リアルタイムで20ステップの進行状況を確認
   - 各調査項目の詳細な状態を監視

4. **結果の確認**
   - 完了後、Notionページで詳細なレポートを確認
   - 統合分析レポートと16個の個別調査結果を取得
   - 色制限内での最適化された視覚的レポートを活用

### TalkLabel事例の入力例
システムには以下のような詳細な事例がプレースホルダーとして設定されています：

- **事業名**: TalkLabel
- **コンセプト**: LINE特化フルファネルMA（運用工数1/3、ブロック率半減、LTV1.5倍）
- **顧客課題**: ブロック率8%超、ROI不透明、決済CVR低下など
- **価格設定**: スターター3,000円〜エンタープライズ49,800円〜
- **獲得チャネル**: SEO記事、共催ウェビナー、代理店制度など

---

## 🏗️ システム構成

### アーキテクチャ
アーキテクチャの中心は、AIの応答を構造化レポートとして受け取り、色制限に対応したNotionブロックに変換するバックエンドエンジンです。

```
┌─────────────────┐      ┌───────────────────────────┐      ┌─────────────────┐
│                 │      │     Backend (Node.js)     │      │  External APIs  │
│ Frontend (UI)   │◄─────►│ ┌───────────────────────┐ │◄─────►│ - Gemini AI     │
│ - TalkLabel例   │      │ │色制限対応 Engine      │ │      │ - Notion API    │
│ - 一括入力      │      │ │ - Deep Research       │ │      │                 │
│ - 進行状況表示  │      │ │ - タイムアウト対応    │ │      │                 │
│ - リアルタイム  │      │ │ - 事前作成方式        │ │      │                 │
│   フィードバック│      │ │ - 動的プロパティ検索  │ │      │                 │
└─────────────────┘      │ └───────────────────────┘ │      │                 │
                         └───────────────────────────┘      └─────────────────┘
```

### 技術スタック
- **Frontend**: HTML5, CSS3, Vanilla JavaScript (ES6+)
- **Backend**: Node.js, TypeScript, Express.js
- **AI Engine**: Google Gemini 2.5 Flash
- **Database**: Notion API（色制限対応ブロック変換）
- **UI Framework**: Pure CSS with advanced animations
- **推奨デプロイ環境**: Railway, Heroku, Vercel

### 新機能の技術詳細（v1.4.0）
- **装飾色制限**: テキスト色（default/red）、背景色（yellow_backgroundのみ）
- **動的プロパティ検索**: 「調査レポート」等の多様なタイトルフィールド名に自動対応
- **一括入力解析**: 22種類の表記バリエーションに対応した自然言語処理
- **Deep Research**: 段階的タイムアウト制御（3分→2分→軽量版）
- **事前作成方式**: 16項目+統合レポートの20ステップ構成
- **進行状況表示**: Server-Sent Eventsによるリアルタイム更新

---

## 🛠️ 開発者ガイド

### 開発コマンド
- **開発モードで起動**: `npm run dev`
- **プロダクションビルド**: `npm run build`
- **サーバー起動**: `npm start`
- **テスト実行**: `npm run test`

### ディレクトリ構成
```
/
├── src/
│   ├── server.ts                 # Expressサーバーのメインファイル
│   ├── services/
│   │   ├── geminiService.ts      # Gemini AIとの連携（色制限指示対応）
│   │   ├── notionService.ts      # Notion APIとの連携（色制限対応ブロック変換）
│   │   ├── researchService.ts    # 16種類の調査を統括するコアエンジン
│   │   ├── deepResearchService.ts # Deep Research機能（タイムアウト対応）
│   │   └── notionBatchService.ts # バッチ処理とカテゴリ分類
│   ├── routes/
│   │   └── research.ts           # APIエンドポイントの定義
│   └── types/
│       └── index.ts              # グローバルな型定義
├── public/
│   ├── index.html                # フロントエンドUI（TalkLabel対応入力フォーム）
│   ├── style.css                 # 改良されたスタイルシート
│   └── script.js                 # 20ステップ進行状況・時間予測機能付きJS
└── README.md                     # このファイル
```

---

## 🔧 API仕様

### 主要エンドポイント

| エンドポイント | メソッド | 説明 |
|:---|:---|:---|
| `/api/research/start` | POST | 市場調査の開始（20ステップSSE、色制限対応） |
| `/api/research/health` | GET | システムヘルスチェック |
| `/api/research/prompts` | GET | 調査プロンプト一覧取得 |
| `/api/research/validate` | POST | リクエストバリデーション |
| `/api/research/info` | GET | システム情報取得 |

### リクエスト例（TalkLabel）
```json
{
  "businessName": "TalkLabel",
  "serviceHypothesis": {
    "concept": "LINE公式上で「友だち獲得→シナリオ配信→LINE内決済→リピート購買」までをノーコードで自動化し、運用工数を 1/3、ブロック率を半減、平均 LTV を 1.5 倍に高めるフルファネル MA",
    "customerProblem": "一斉配信依存でブロック率 8％超／CTR 1％台、広告・店頭・ EC が分断して ROI が読めない、HTML や SQL が書けず AB テストが回らない",
    "targetIndustry": "美容・健康 D2C（定期購入比率が高い）、飲食チェーンやサロン FC（クーポン来店とテイクアウトの両立）",
    "targetUsers": "月商 500 万～ 5 億規模の EC／店舗事業責任者、エクセルと LINE の手作業運用に限界を感じる非エンジニアのマーケ担当",
    "competitors": "直接競合＝ Liny（大企業向け高単価）／エルメ（低価格だが機能限定）／ KUZEN for LINE（チャットボット主軸）"
  }
}
```

---

## 🤝 コントリビューション

### 開発への参加
バグ報告、機能要望、Pull Requestはいつでも歓迎します。

### 課題・改善案の報告
- [Issues](https://github.com/t-hamamura/market-research-system/issues)から報告してください
- UI/UXの改善提案も歓迎です

### Pull Request
1. フォークしてください
2. フィーチャーブランチを作成してください (`git checkout -b feature/新機能`)
3. 変更をコミットしてください (`git commit -am '新機能を追加'`)
4. ブランチにプッシュしてください (`git push origin feature/新機能`)
5. Pull Requestを作成してください

---

## 🚀 今後の開発予定

- **🎨 カスタム装飾対応**: ユーザー定義の色パレット設定機能
- **🤖 カスタムAIモデル**: 市場調査特化型のファインチューニング
- **📱 モバイルアプリ**: iOS/Android対応のネイティブアプリ
- **🔗 他ツール連携**: Slack、Teams、Google Driveとの連携
- **📊 ダッシュボード機能**: 調査結果の可視化・分析機能
- **🌐 多言語対応**: 英語・中国語・韓国語での市場調査
- **⚡ Deep Research機能拡張**: より高精度な調査アルゴリズム

---

## 📄 ライセンス

This project is licensed under the MIT License.

## 📞 サポート

ご質問やサポートが必要な場合は、[Issues](https://github.com/t-hamamura/market-research-system/issues)またはメールでお気軽にお問い合わせください。

---

## 🔧 環境変数設定詳細

### 必須環境変数

| 変数名 | 説明 | 例 |
|:---|:---|:---|
| `GEMINI_API_KEY` | Google Gemini API キー | `AIza...` |
| `NOTION_TOKEN` | Notion Integration Token | `secret_...` |
| `NOTION_DATABASE_ID` | Notion データベース ID | `20cd3748...` |

### Gemini AI設定（一括管理）

| 変数名 | 説明 | デフォルト値 | 設定例 |
|:---|:---|:---|:---|
| `GEMINI_MODEL` | 使用するGeminiモデル | `gemini-2.5-flash` | `gemini-2.0-flash-exp`, `gemini-1.5-flash` |
| `GEMINI_TEMPERATURE` | AI応答の創造性 (0.0-2.0) | `0.7` | `0.3` (保守的), `1.0` (創造的) |
| `GEMINI_MAX_TOKENS` | 最大出力トークン数 | `8192` | `4096`, `16384` |

### パフォーマンス最適化

| 変数名 | 説明 | デフォルト値 | 推奨範囲 |
|:---|:---|:---|:---|
| `PARALLEL_BATCH_SIZE` | 並列実行数 | `4` | `1-8` |
| `BATCH_INTERVAL` | バッチ間隔 (ms) | `2000` | `1000-5000` |
| `RESEARCH_INTERVAL` | 調査間隔 (ms) | `2000` | `1500-3000` |

### 🎯 Geminiモデル選択ガイド

- **gemini-2.5-flash** (推奨): 最新モデル、高品質で高速
- **gemini-2.0-flash-exp**: 実験版、新機能テスト用
- **gemini-1.5-flash**: 安定版、レート制限が緩い場合に適用

### 💡 設定のベストプラクティス

1. **開発環境**: `GEMINI_TEMPERATURE=1.0`で創造的な結果を取得
2. **本番環境**: `GEMINI_TEMPERATURE=0.7`で安定した結果
3. **高負荷環境**: `PARALLEL_BATCH_SIZE=2`, `RESEARCH_INTERVAL=3000` 